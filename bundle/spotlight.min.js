"use strict";var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Penner=require("penner"),Spotlight=function(){function t(e){_classCallCheck(this,t),this.options=e||{},this.canvas=document.createElement("canvas"),this.options.parent?this.options.parent.appendChild(this.canvas):document.body.appendChild(this.canvas),this.canvas.style.position="fixed",this.canvas.style.top=this.options.x||0,this.canvas.style.left=this.options.y||0,this.canvas.style.pointerEvents="none",this.openings=[],this.resize()}return _createClass(t,[{key:"resize",value:function(){var t=this.options.width||window.innerWidth,e=this.options.height||window.innerHeight;return this.canvas.width=t,this.canvas.height=e,this.redraw(),this}},{key:"redraw",value:function(){var t=this.canvas.getContext("2d");t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.options.color||"black",t.globalAlpha=this.options.alpha||.5,t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore(),t.save(),t.globalCompositeOperation="destination-out";var e=!0,i=!1,n=void 0;try{for(var s,a=this.openings[Symbol.iterator]();!(e=(s=a.next()).done);e=!0){var r=s.value;switch(r.type){case"circle":t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();break;case"rectangle":t.beginPath(),t.fillRect(r.x,r.y,r.width,r.height);break;case"polygon":t.beginPath(),t.moveTo(r.points[0],r.points[1]);for(var o=2;o<r.points.length;o+=2)t.lineTo(r.points[o],r.points[o+1]);t.closePath(),t.fill()}}}catch(t){i=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(i)throw n}}return t.restore(),this}},{key:"clear",value:function(t){return this.openings=[],t||this.resize(),this}},{key:"circle",value:function(t,e,i,n){this.openings.push({type:"circle",x:t,y:e,radius:i}),n||this.redraw()}},{key:"rectangle",value:function(t,e,i,n,s){return this.openings.push({type:"rectangle",x:t,y:e,width:i,height:n}),s||this.redraw(),this}},{key:"polygon",value:function(t,e){return this.openings.push({type:"polygon",points:t}),e||this.redraw(),this}},{key:"fade",value:function(t){var e=this;this.request=null;var i=performance.now(),n=i-this.last;this.last=i,t.time+=n;var s=t.end-t.start;t.time>t.duration?this.canvas.style.opacity=t.end:(this.canvas.style.opacity=t.ease(t.time,t.start,s,t.duration),this.request=requestAnimationFrame(function(){return e.fade(t)}))}},{key:"fadeIn",value:function(t){this.request&&cancelAnimationFrame(this.request);var e=void 0===(t=t||{}).start?0:t.start,i=void 0===t.end?1:t.end,n=t.ease?"string"==typeof t.ease?Penner[t.ease]:t.ease:Penner.easeInOutSine;this.canvas.style.opacity=e;var s=t.duration||1e3;return this.last=performance.now(),this.fade({time:0,start:e,end:i,duration:s,ease:n}),this}},{key:"fadeOut",value:function(t){return(t=t||{}).start=void 0===t.start?1:t.start,t.end=void 0===t.end?0:t.end,this.fadeIn(t),this}},{key:"show",value:function(){return this.canvas.style.display="block",this}},{key:"hide",value:function(){return this.canvas.style.display="none",this}},{key:"isVisible",value:function(){return"block"===this.canvas.style.display}},{key:"destroy",value:function(){this.options.parent?this.options.parent.removeChild(this.canvas):document.body.removeChild(this.canvas)}}]),t}();module.exports=Spotlight;