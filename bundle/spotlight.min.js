"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Penner=require("penner"),Spotlight=function(){function t(e){_classCallCheck(this,t),this.options=e||{},this.canvas=document.createElement("canvas"),this.options.parent?this.options.parent.appendChild(this.canvas):document.body.appendChild(this.canvas),this.canvas.style.position="fixed",this.canvas.style.top=this.options.x||0,this.canvas.style.left=this.options.y||0,this.canvas.style.pointerEvents="none",this.openings=[],this.resize()}return _createClass(t,[{key:"resize",value:function(){var t=this.options.width||window.innerWidth,e=this.options.height||window.innerHeight;return this.canvas.width=t,this.canvas.height=e,this.redraw(),this}},{key:"redraw",value:function(){var t=this.canvas.getContext("2d");t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.options.color||"black",t.globalAlpha=this.options.alpha||.5,t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore(),t.save(),t.globalCompositeOperation="destination-out";var e=!0,n=!1,i=void 0;try{for(var s,a=this.openings[Symbol.iterator]();!(e=(s=a.next()).done);e=!0){var r=s.value;switch(r.type){case"circle":t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();break;case"rectangle":t.beginPath(),t.fillRect(r.x,r.y,r.width,r.height);break;case"polygon":t.beginPath(),t.moveTo(r.points[0],r.points[1]);for(var o=2;o<r.points.length;o+=2)t.lineTo(r.points[o],r.points[o+1]);t.closePath(),t.fill()}}}catch(t){n=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw i}}return t.restore(),this}},{key:"clear",value:function(t){return this.openings=[],t||this.resize(),this}},{key:"circle",value:function(t,e,n,i){this.openings.push({type:"circle",x:t,y:e,radius:n}),i||this.redraw()}},{key:"rectangle",value:function(t,e,n,i,s){return this.openings.push({type:"rectangle",x:t,y:e,width:n,height:i}),s||this.redraw(),this}},{key:"polygon",value:function(t,e){return this.openings.push({type:"polygon",points:t}),e||this.redraw(),this}},{key:"fade",value:function(t){var e=this;this.request=null;var n=performance.now(),i=n-this.last;this.last=n,t.time+=i;var s=t.end-t.start;t.time>t.duration?(this.canvas.style.opacity=t.end,t.onEnd&&t.onEnd()):(this.canvas.style.opacity=t.ease(t.time,t.start,s,t.duration),this.request=requestAnimationFrame(function(){return e.fade(t)}))}},{key:"fadeIn",value:function(t){this.request&&cancelAnimationFrame(this.request);var e=void 0===(t=t||{}).start?0:t.start,n=void 0===t.end?1:t.end,i=t.ease?"string"==typeof t.ease?Penner[t.ease]:t.ease:Penner.easeInOutSine,s=t.onEnd;this.canvas.style.opacity=e;var a=t.duration||1e3;return this.last=performance.now(),this.fade({time:0,start:e,end:n,duration:a,ease:i,onEnd:s}),this}},{key:"fadeOut",value:function(t){return(t=t||{}).start=void 0===t.start?1:t.start,t.end=void 0===t.end?0:t.end,this.fadeIn(t),this}},{key:"show",value:function(){return this.canvas.style.display="block",this}},{key:"hide",value:function(){return this.canvas.style.display="none",this}},{key:"isVisible",value:function(){return"block"===this.canvas.style.display}},{key:"destroy",value:function(){this.options.parent?this.options.parent.removeChild(this.canvas):document.body.removeChild(this.canvas)}}]),t}();module.exports=Spotlight;